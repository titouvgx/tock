
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../bot-api/">
      
      
        <link rel="next" href="../connectors/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Bot intégré - Tock Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developper-en-mode-tock-bot-integre" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Tock Documentation" class="md-header__button md-logo" aria-label="Tock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Tock Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bot intégré
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="Select language">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.5 17.5 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2zm-2.62 7 1.62-4.33L19.12 17z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="./" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="../../fr/dev/bot-integre/" hreflang="fr" class="md-select__link">
              Français
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Tock Documentation" class="md-nav__button md-logo" aria-label="Tock Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Tock Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tock
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    About
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            About
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/awards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Awards
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact us
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contribute/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/jobs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/ressources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/showcase/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User Showcase
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/why/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Why Tock
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Admin
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Admin
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/availability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    High Availability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/security/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Security
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/supervision/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supervision
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../admin/synchronization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation of the Multilingual Synchronization Feature
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Dev
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Dev
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../bot-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bot API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Bot intégré
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Bot intégré
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#demarrer-avec-le-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Démarrer avec le framework
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Démarrer avec le framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documentation-kdoc" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation KDoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependance-bot-toolkit" class="md-nav__link">
    <span class="md-ellipsis">
      Dépendance bot-toolkit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-bot-est-un-ensemble-de-parcours-stories" class="md-nav__link">
    <span class="md-ellipsis">
      Un bot est un ensemble de parcours (stories)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#une-story-simple" class="md-nav__link">
    <span class="md-ellipsis">
      Une Story simple
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demarrer-et-connecter-le-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Démarrer et connecter le bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importer-la-configuration-dumps" class="md-nav__link">
    <span class="md-ellipsis">
      Importer la configuration (dumps)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aller-plus-loin" class="md-nav__link">
    <span class="md-ellipsis">
      Aller plus loin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aller plus loin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intentions-secondaires" class="md-nav__link">
    <span class="md-ellipsis">
      Intentions secondaires
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipuler-les-entites" class="md-nav__link">
    <span class="md-ellipsis">
      Manipuler les entités
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-handlerdef" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser HandlerDef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-connectordef" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser ConnectorDef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-storystep" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser StoryStep
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utiliser StoryStep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simplestorystep" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleStoryStep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-storystep-avec-comportement" class="md-nav__link">
    <span class="md-ellipsis">
      Les StoryStep avec comportement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postback-buttons-quick-replies" class="md-nav__link">
    <span class="md-ellipsis">
      Postback buttons &amp; quick replies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-unitaires" class="md-nav__link">
    <span class="md-ellipsis">
      Tests Unitaires
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../connectors/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Connectors
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples-code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../i18n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i18n - development
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tester
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_9" >
        
          
          <label class="md-nav__link" for="__nav_4_9" id="__nav_4_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Advanced
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9">
            <span class="md-nav__icon md-icon"></span>
            Advanced
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/bot-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BotApi
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/collections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Tock collections
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/main-classes-explanation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Main classes explanation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/packages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explication des packages Tock
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_9_5" >
        
          
          <label class="md-nav__link" for="__nav_4_9_5" id="__nav_4_9_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Nlp
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_9_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_9_5">
            <span class="md-nav__icon md-icon"></span>
            Nlp
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/nlp/nlp-evaluation-with-duckling-and-dictionary%20%28%20end%20of%20file%29/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nlp evaluation with duckling and dictionary ( end of file)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/nlp/nlp-intents-and-entities-evaluation-simplifed-diagram/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Nlp intents and entities evaluation simplifed diagram
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced/nlp/nlp-models-and-entity-models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Les modèles NLP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    User
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            User
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guides
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tock Studio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/guides/build-model/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Conversational models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/guides/canaux/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Channels
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/guides/i18n/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    i18n - guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/guides/intents-restrictions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intent Restriction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Studio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Studio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/analytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analytics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/custom-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/faq-management/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/faq-training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ Training
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Tock Studio interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/nlu-qa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model Quality
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/nlu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NLU
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/stories-and-answers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Stories and Answers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_5_11" id="__nav_5_5_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gen ai
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_11">
            <span class="md-nav__icon md-icon"></span>
            Gen ai
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/gen-ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen AI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_11_2" >
        
          
          <label class="md-nav__link" for="__nav_5_5_11_2" id="__nav_5_5_11_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Features
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_11_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_11_2">
            <span class="md-nav__icon md-icon"></span>
            Features
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/features/gen-ai-feature-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen AI - Observability Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/features/gen-ai-feature-rag-exclusion/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen AI / RAG Exclusions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/features/gen-ai-feature-rag/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen AI / RAG Settings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/features/gen-ai-feature-sentence-generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gen AI - Sentence generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/features/gen-ai-feature-vector-store/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Le menu Gen AI - Vector Store Settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5_11_3" >
        
          
          <label class="md-nav__link" for="__nav_5_5_11_3" id="__nav_5_5_11_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Providers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_5_11_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5_11_3">
            <span class="md-nav__icon md-icon"></span>
            Providers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/providers/gen-ai-provider-llm-and-embedding/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fournisseurs des modèles LLM et d'Embedding
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/providers/gen-ai-provider-observability/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fournisseurs d'observabilité des LLMs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../user/studio/gen-ai/providers/gen-ai-provider-vector-store/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fournisseurs de base vectorielle
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#demarrer-avec-le-framework" class="md-nav__link">
    <span class="md-ellipsis">
      Démarrer avec le framework
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Démarrer avec le framework">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#documentation-kdoc" class="md-nav__link">
    <span class="md-ellipsis">
      Documentation KDoc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dependance-bot-toolkit" class="md-nav__link">
    <span class="md-ellipsis">
      Dépendance bot-toolkit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#un-bot-est-un-ensemble-de-parcours-stories" class="md-nav__link">
    <span class="md-ellipsis">
      Un bot est un ensemble de parcours (stories)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#une-story-simple" class="md-nav__link">
    <span class="md-ellipsis">
      Une Story simple
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#demarrer-et-connecter-le-bot" class="md-nav__link">
    <span class="md-ellipsis">
      Démarrer et connecter le bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#importer-la-configuration-dumps" class="md-nav__link">
    <span class="md-ellipsis">
      Importer la configuration (dumps)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aller-plus-loin" class="md-nav__link">
    <span class="md-ellipsis">
      Aller plus loin
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aller plus loin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#intentions-secondaires" class="md-nav__link">
    <span class="md-ellipsis">
      Intentions secondaires
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manipuler-les-entites" class="md-nav__link">
    <span class="md-ellipsis">
      Manipuler les entités
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-handlerdef" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser HandlerDef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-connectordef" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser ConnectorDef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#utiliser-storystep" class="md-nav__link">
    <span class="md-ellipsis">
      Utiliser StoryStep
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Utiliser StoryStep">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simplestorystep" class="md-nav__link">
    <span class="md-ellipsis">
      SimpleStoryStep
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#les-storystep-avec-comportement" class="md-nav__link">
    <span class="md-ellipsis">
      Les StoryStep avec comportement
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postback-buttons-quick-replies" class="md-nav__link">
    <span class="md-ellipsis">
      Postback buttons &amp; quick replies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tests-unitaires" class="md-nav__link">
    <span class="md-ellipsis">
      Tests Unitaires
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="developper-en-mode-tock-bot-integre">Développer en mode Tock Bot intégré</h1>
<p>Le mode <em>Bot intégré</em> Tock permet de développer un bot en utilisant un 
<a href="https://fr.wikipedia.org/wiki/Langage_d%C3%A9di%C3%A9">Domain Specifique Language (DSL)</a> 
 en <a href="https://kotlinlang.org/">Kotlin</a>.</p>
<p>Contrairement au mode <em>Bot API</em> encore en développement, le <em>Bot Framework</em> Kotlin permet d'exploiter toutes les 
possibilités de la plateforme Tock, notamment :</p>
<ul>
<li>Gestion des contextes utilisateurs</li>
<li>Historique de conversation</li>
<li>Notions avancées comme la <em>fusion d'entités</em></li>
<li>Etc.</li>
</ul>
<blockquote>
<p>Exemple de <em>fusion d'entités</em> : lorsque un utilisateur demande "demain" dans une phrase 
(appelons cette entité <em>date</em>) puis "plutôt le soir" dans une phrase suivante, la fusion permet de mettre à jour 
automatiquement l'entité (<em>date</em>) avec les deux informations complémentaires : jour et créneau horaire dans cet exemple.</p>
</blockquote>
<p>Attention : dans ce mode de développement, contrairement au mode <a href="bot-api"><em>Bot API</em></a>, il est nécessaire que le module bot 
 dispose d'une connexion à la base de donnée (MongoDB) de la plateforme Tock utilisée.</p>
<blockquote>
<p>Pour appréhender complètement ce qui va suivre, il est recommandé de maîtriser les bases du 
langage de programmation <a href="https://kotlinlang.org/">Kotlin</a>.</p>
</blockquote>
<h2 id="demarrer-avec-le-framework">Démarrer avec le framework</h2>
<h3 id="documentation-kdoc">Documentation KDoc</h3>
<p>La documentation du framework au format KDoc est disponible <a href="https://doc.tock.ai/tock/dokka/tock">ici</a>.</p>
<h3 id="dependance-bot-toolkit">Dépendance <code>bot-toolkit</code></h3>
<p>Pour utiliser le framework conversationnel, il faut ajouter la dépendance <code>bot-tookit</code> à l'application / au projet
Kotlin.</p>
<p>Par exemple dans un projet <a href="https://maven.apache.org/">Maven</a> :</p>
<div class="highlight"><pre><span></span><code><span class="w">        </span><span class="nt">&lt;dependency&gt;</span>
<span class="w">            </span><span class="nt">&lt;groupId&gt;</span>ai.tock<span class="nt">&lt;/groupId&gt;</span>
<span class="w">            </span><span class="nt">&lt;artifactId&gt;</span>bot-toolkit<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">            </span><span class="nt">&lt;version&gt;</span>24.9.4<span class="nt">&lt;/version&gt;</span>
<span class="w">        </span><span class="nt">&lt;/dependency&gt;</span>
</code></pre></div>
<p>Ou dans un projet <a href="https://gradle.org/">Gradle</a> :</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span><span class="n">compile</span><span class="w"> </span><span class="s1">&#39;ai.tock:bot-toolkit:24.9.4&#39;</span>
</code></pre></div>
<h3 id="un-bot-est-un-ensemble-de-parcours-stories">Un bot est un ensemble de parcours (stories)</h3>
<p>Voici par exemple comment le Bot Open Data est défini :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">openBot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bot</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;bot_open_data&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">stories</span><span class="w"> </span><span class="o">=</span>
<span class="w">        </span><span class="n">listOf</span><span class="p">(</span>
<span class="w">                </span><span class="n">greetings</span><span class="p">,</span>
<span class="w">                </span><span class="n">departures</span><span class="p">,</span>
<span class="w">                </span><span class="n">arrivals</span><span class="p">,</span>
<span class="w">                </span><span class="n">search</span>
<span class="w">        </span><span class="p">),</span>
<span class="w">        </span><span class="n">hello</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">greetings</span>
<span class="p">)</span>
</code></pre></div>
<p>Ce bot comporte un identifiant (obligatoire - "bot_open_data") et une liste de parcours ou <em>stories</em>.</p>
<p>Une <em>Story</em> est un regroupement fonctionnel qui correspond à une intention principale et, de manière optionelle,
à une ou plusieurs intentions dites "secondaires" (voir <a href="../user/concepts">Concepts</a>).</p>
<p>Ici le bot définit 4 parcours : <code>greetings</code>, <code>departures</code>, <code>arrivals</code> et <code>search</code>. </p>
<p>Le parcours <code>greetings</code> est déclaré comme parcours principal, il sera présenté par défaut au début d'une conversation :
<code>hello = greetings</code>.</p>
<h3 id="une-story-simple">Une Story simple</h3>
<p><em>Comment définit-on une Story?</em></p>
<p>Voici une première version simplifiée du parcours <code>greetings</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">greetings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">story</span><span class="p">(</span><span class="s">&quot;greetings&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Bienvenue chez le Bot Open Data Sncf! :)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Il s&#39;agit d&#39;un bot de démonstration du framework Tock : https://github.com/theopenconversationkit/tock&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Notez que dans le corps de la fonction, <code>this</code> est de type <a href="https://doc.tock.ai/tock/dokka/tock/ai.tock.bot.engine/-bot-bus/index.html"><code>BotBus</code></a>,
à partir duquel vous pouvez interagir avec l'utilisateur, et qui permet également d'accèder
à tous les élements contextuels disponibles.</p>
<p>Concrètement sela signifie que quand l'intention <code>greetings</code> sera détectée par le modèle NLP, la fonction ci-dessus sera appelée par le framework Tock.</p>
<p>Le bot envoie donc successivement une première phrase de réponse (<code>bus.send()</code>), puis un deuxième en indiquant que c'est 
la dernière phrase de sa réponse à l'aide d'un <code>bus.end()</code>.</p>
<p>Voici maintenant la version complète de <code>greetings</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">greetings</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">story</span><span class="p">(</span><span class="s">&quot;greetings&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//cleanup state</span>
<span class="w">    </span><span class="n">resetDialogState</span><span class="p">()</span>

<span class="w">    </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Bienvenue chez le Bot Open Data Sncf! :)&quot;</span><span class="p">)</span>
<span class="w">    </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Il s&#39;agit d&#39;un bot de démonstration du framework Tock : https://github.com/theopenconversationkit/tock&quot;</span><span class="p">)</span>

<span class="w">    </span><span class="n">withMessenger</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">buttonsTemplate</span><span class="p">(</span>
<span class="w">              </span><span class="s">&quot;Il est volontairement très limité, mais demandez lui un itinéraire ou les départs à partir d&#39;une gare et constatez le résultat! :) &quot;</span><span class="p">,</span>
<span class="w">              </span><span class="n">postbackButton</span><span class="p">(</span><span class="s">&quot;Itinéraires&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">search</span><span class="p">),</span>
<span class="w">              </span><span class="n">postbackButton</span><span class="p">(</span><span class="s">&quot;Départs&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Departures</span><span class="p">),</span>
<span class="w">              </span><span class="n">postbackButton</span><span class="p">(</span><span class="s">&quot;Arrivées&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Arrivals</span><span class="p">)</span>
<span class="w">        </span><span class="p">)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">withGoogleAssistant</span><span class="w"> </span><span class="p">{</span>
<span class="w">       </span><span class="n">gaMessage</span><span class="p">(</span>
<span class="w">              </span><span class="s">&quot;Il est volontairement très limité, mais demandez lui un itinéraire ou les départs à partir d&#39;une gare et constatez le résultat! :) &quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s">&quot;Itinéraires&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s">&quot;Départs&quot;</span><span class="p">,</span>
<span class="w">              </span><span class="s">&quot;Arrivées&quot;</span><span class="p">)</span>
<span class="w">       </span><span class="p">}</span>

<span class="w">    </span><span class="n">end</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>
<p>Deux notions ont été ajoutées :</p>
<ul>
<li>
<p><code>resetDialogState()</code> qui permet de repartir d'un contexte utilisateur vide (en oubliant les éventuels échanges précédents)</p>
</li>
<li>
<p>les méthodes <code>withMessenger{}</code> et <code>withGoogleAssistant{}</code> qui permettent de définir des réponses spécifiques pour chaque connecteur.
Ici un texte avec des boutons pour Messenger, et un texte avec des suggestions pour Google Assistant.</p>
</li>
</ul>
<h3 id="demarrer-et-connecter-le-bot">Démarrer et connecter le bot</h3>
<p>Pour démarrer le bot, il suffit de rajouter dans votre <code>main</code> principal l'appel suivant :</p>
<div class="highlight"><pre><span></span><code><span class="n">registerAndInstallBot</span><span class="p">(</span><span class="n">openBot</span><span class="p">)</span>
</code></pre></div>
<p>La variable <code>openBot</code> dans l'exemple est le bot que vous avez défini plus haut.</p>
<p>Une fois le bot démarré, il est également nécessaire de spécifier quels connecteurs sont utilisés
dans l'interface d'administration du bot, du menu <em>Configuration</em> &gt; <em>Bot Configurations</em> &gt; <em>Create a new configuration</em>.</p>
<p>Pour en savoir plus sur les différents canaux et connecteurs, voir <a href="../user/guides/canaux">cette page</a>.</p>
<h3 id="importer-la-configuration-dumps">Importer la configuration (dumps)</h3>
<p>Il est possible d'exporter différentes configurations depuis Tock Studio, puis les
importer automatiquement au démarrage du bot.</p>
<p>Une fois exportés les fichiers <em>dumps</em> de Tock Studio dans le <em>classpath</em> du bot, 
on peut appeler une ou plusieurs des fonctions suivantes depuis le <code>main</code> :</p>
<ul>
<li><code>importApplicationDump</code> : importe une application à partir d'un 
  <a href="../user/studio/configuration#modifier-importer-et-exporter-une-application"><em>dump</em> d'application</a>.
  Remarque : l'import est ignoré si l'application cible existe déjà.</li>
<li><code>importNlpDump</code> : importe un modèle NLP (intentions, phrases, entités) à partir d'un
  <a href="../user/studio/configuration#modifier-importer-et-exporter-une-application"><em>dump</em> NLP</a>.</li>
<li><code>importI18nDump</code> : importe des labels (aka <em>i18n</em>) à partir d'un
  <a href="../user/studio/stories-and-answers#longlet-answers"><em>dump</em> de labels</a>.</li>
</ul>
<p>Exemple :</p>
<div class="highlight"><pre><span></span><code><span class="kd">fun</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span><span class="w"> </span><span class="n">Array</span><span class="o">&lt;</span><span class="kt">String</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">  </span><span class="n">registerAndInstallBot</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// Import application</span>
<span class="w">  </span><span class="n">importApplicationDump</span><span class="p">(</span><span class="s">&quot;/bot_app_dump.json&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// Import NLP model (intents, sentences, entities...)</span>
<span class="w">  </span><span class="n">importNlpDump</span><span class="p">(</span><span class="s">&quot;/bot_nlp_dump.json&quot;</span><span class="p">)</span>

<span class="w">  </span><span class="c1">// Import story labels (aka i18n)</span>
<span class="w">  </span><span class="n">importI18nDump</span><span class="p">(</span><span class="s">&quot;/bot_labels_dump.json&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="aller-plus-loin">Aller plus loin</h2>
<p>Bien sûr, le <code>StoryHandler</code> de <code>greetings</code> ne dépend pas du contexte : la réponse est toujours la même.</p>
<p>Pour le développement de stories complexes, nous avons besoin d'une abstraction supplémentaire.</p>
<h3 id="intentions-secondaires">Intentions secondaires</h3>
<p>Voici le début de la définition de la story <code>search</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storyDef</span><span class="o">&lt;</span><span class="n">SearchDef</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;search&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">otherStarterIntents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_origin</span><span class="p">),</span>
<span class="w">        </span><span class="n">secondaryIntents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="p">}</span>
</code></pre></div>
<p>Le parcours <code>search</code> définit une intention secondaire "de démarrage" (<code>indicate_origin</code>) 
et une intention secondaire simple (<code>indicate_location</code>).</p>
<p>Une intention secondaire "de démarrage" est semblable en tout point à une intention principale : 
dès que cette intention est détectée, le parcours <code>search</code> va être exécuté, 
si la story courante ne possède pas cette intention en tant qu'intention secondaire.</p>
<p>Pour une intention secondaire simple, par contre, la story ne sera exécutée que si la story courante du contexte 
est "déjà" la story search. Plusieurs story différentes peuvent donc partager les mêmes intentions secondaires.</p>
<h3 id="manipuler-les-entites">Manipuler les entités</h3>
<p>Pour récupérer les valeurs des entités, une bonne pratique est de définir des <strong>extensions</strong>. 
Par exemple voici le code utilisé pour récupérer l'entité <code>destination</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">destinationEntity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">openBot</span><span class="p">.</span><span class="na">entity</span><span class="p">(</span><span class="s">&quot;location&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;destination&quot;</span><span class="p">)</span><span class="w"> </span>

<span class="kd">var</span><span class="w"> </span><span class="nv">BotBus</span><span class="p">.</span><span class="na">destination</span><span class="p">:</span><span class="w"> </span><span class="n">Place?</span>
<span class="w">    </span><span class="k">get</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">place</span><span class="p">(</span><span class="n">destinationEntity</span><span class="p">)</span>
<span class="w">    </span><span class="k">set</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">setPlace</span><span class="p">(</span><span class="n">destinationEntity</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span>

<span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="n">BotBus</span><span class="p">.</span><span class="nf">place</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="p">):</span><span class="w"> </span><span class="n">Place? </span><span class="o">=</span><span class="w"> </span><span class="n">entityValue</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="n">placeValue</span><span class="p">)</span><span class="o">?.</span><span class="na">place</span>

<span class="kd">private</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="n">BotBus</span><span class="p">.</span><span class="nf">setPlace</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span><span class="w"> </span><span class="n">Entity</span><span class="p">,</span><span class="w"> </span><span class="n">place</span><span class="p">:</span><span class="w"> </span><span class="n">Place?)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">changeEntityValue</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span><span class="w"> </span><span class="n">place</span><span class="o">?.</span><span class="na">let</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">PlaceValue</span><span class="p">(</span><span class="n">place</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
</code></pre></div>
<p>Une entité de type <code>location</code> et de role <code>destination</code> est créée. 
Il s'agit de l'entité correspondante dans le modèle NLP.</p>
<p>Une variable <code>destination</code> est définie, qui va simplifier la manipulation de cette entité dans le code métier.
Cette variable contient la valeur actuelle de la destination dans le contexte utilisateur.</p>
<p>Voici une version complétée de la story <code>search</code> qui utilise <code>destination</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storyDef</span><span class="o">&lt;</span><span class="n">SearchDef</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;search&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_origin</span><span class="p">),</span>
<span class="w">        </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">//check mandatory entities</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">destination</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Pour quelle destination?&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Pour quelle origine?&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">departureDate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Quand souhaitez-vous partir?&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span>
<span class="p">}</span>
</code></pre></div>
<p>Si il n'y a pas de valeur dans le contexte courant pour la destination, le bot demande de spécifier la destination et en reste là.
Idem pour l'origine ou la date de départ.</p>
<p>Si les 3 valeurs obligatoires sont spécifiées, il passe à la réponse proprement dite développée dans la classe (<code>SearchDef</code>).</p>
<p>La version complète de cette première partie du code est la suivante :</p>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">search</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storyDef</span><span class="o">&lt;</span><span class="n">SearchDef</span><span class="o">&gt;</span><span class="p">(</span>
<span class="w">        </span><span class="s">&quot;search&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_origin</span><span class="p">),</span>
<span class="w">        </span><span class="n">setOf</span><span class="p">(</span><span class="n">indicate_location</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">//handle generic location intent</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isIntent</span><span class="p">(</span><span class="n">indicate_location</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">location</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">destination</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">origin</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">destination</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">returnsAndRemoveLocation</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="n">origin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">returnsAndRemoveLocation</span><span class="p">()</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span><span class="w">    </span>

<span class="w">        </span><span class="c1">//check mandatory entities</span>
<span class="w">        </span><span class="k">when</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">destination</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Pour quelle destination?&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">origin</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Pour quelle origine?&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">departureDate</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Quand souhaitez-vous partir?&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Dans le cas où l'intention détectée est <code>indicate_location</code>, nous ne savons pas si la localité indiquée représente l'origine ou la destination.
Il est donc codé une règle simple : 
Si il existe déjà dans le contexte une origine et pas de destination, la nouvelle localité est en fait la destination.
Sinon, il s'agit de l'origine. </p>
<h3 id="utiliser-handlerdef">Utiliser <code>HandlerDef</code></h3>
<p>Dans la définition de la story <code>search</code> ci-dessus, vous avez pu noter le typage générique <code>SearchDef</code>. 
Voici le code de cette classe :</p>
<div class="highlight"><pre><span></span><code><span class="nd">@GAHandler</span><span class="p">(</span><span class="n">GASearchConnector</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="nd">@MessengerHandler</span><span class="p">(</span><span class="n">MessengerSearchConnector</span><span class="o">::</span><span class="n">class</span><span class="p">)</span>
<span class="kd">class</span><span class="w"> </span><span class="nc">SearchDef</span><span class="p">(</span><span class="n">bus</span><span class="p">:</span><span class="w"> </span><span class="n">BotBus</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">HandlerDef</span><span class="o">&lt;</span><span class="n">SearchConnector</span><span class="o">&gt;</span><span class="p">(</span><span class="n">bus</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">d</span><span class="p">:</span><span class="w"> </span><span class="n">Place</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bus</span><span class="p">.</span><span class="na">destination</span><span class="o">!!</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">o</span><span class="p">:</span><span class="w"> </span><span class="n">Place</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bus</span><span class="p">.</span><span class="na">origin</span><span class="o">!!</span>
<span class="w">    </span><span class="kd">private</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">date</span><span class="p">:</span><span class="w"> </span><span class="n">LocalDateTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bus</span><span class="p">.</span><span class="na">departureDate</span><span class="o">!!</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">answer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;De {0} à {1}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">)</span>
<span class="w">        </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Départ le {0}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">datetimeFormat</span><span class="p">)</span>
<span class="w">        </span><span class="kd">val</span><span class="w"> </span><span class="nv">journeys</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">SncfOpenDataClient</span><span class="p">.</span><span class="na">journey</span><span class="p">(</span><span class="n">o</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">)</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">journeys</span><span class="p">.</span><span class="na">isEmpty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;Désolé, aucun itinéraire trouvé :(&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">send</span><span class="p">(</span><span class="s">&quot;Voici la première proposition :&quot;</span><span class="p">)</span>
<span class="w">            </span><span class="n">connector</span><span class="o">?.</span><span class="na">sendFirstJourney</span><span class="p">(</span><span class="n">journeys</span><span class="p">.</span><span class="na">first</span><span class="p">())</span>
<span class="w">            </span><span class="n">end</span><span class="p">()</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>SearchDef</code> étend <code>HandlerDef</code> qui est un alias d'une classe du framework Tock.</p>
<p>C'est en général ici que l'on va définir le code métier des parcours complexes. </p>
<p>Le code est relativement parlant, mais il contient une abstraction supplémentaire : <code>SearchConnector</code>.</p>
<p><code>SearchConnector</code> est la classe qui définit le comportement spécifique à chaque connecteur, et les annotations
 <code>@GAHandler(GASearchConnector::class)</code> et <code>@MessengerHandler(MessengerSearchConnector::class)</code> 
 indiquent les implémentations correspondantes pour les différents connecteurs supportés (respectivement Google Assistant et Messenger).</p>
<p>Que se passerait-il s'il n'y avait pas de connecteur pour Google Assistant par exemple ? 
 La méthode <code>connector?.sendFirstJourney(journeys.first())</code> n'enverrait pas la réponse finale, puisque <code>connector</code> serait <code>null</code>.</p>
<h3 id="utiliser-connectordef">Utiliser <code>ConnectorDef</code></h3>
<p>Voici maintenant une version simplifiée de <code>SearchConnector</code> :</p>
<div class="highlight"><pre><span></span><code><span class="kd">sealed</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">SearchConnector</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">SearchDef</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ConnectorDef</span><span class="o">&lt;</span><span class="n">SearchDef</span><span class="o">&gt;</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="n">Section</span><span class="p">.</span><span class="nf">title</span><span class="p">():</span><span class="w"> </span><span class="n">CharSequence</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i18n</span><span class="p">(</span><span class="s">&quot;{0} - {1}&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">from</span><span class="p">,</span><span class="w"> </span><span class="n">to</span><span class="p">)</span>

<span class="w">    </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendFirstJourney</span><span class="p">(</span><span class="n">journey</span><span class="p">:</span><span class="w"> </span><span class="n">Journey</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">withMessage</span><span class="p">(</span><span class="n">sendFirstJourney</span><span class="p">(</span><span class="n">journey</span><span class="p">.</span><span class="na">publicTransportSections</span><span class="p">()))</span>

<span class="w">    </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendFirstJourney</span><span class="p">(</span><span class="n">sections</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ConnectorMessage</span>

<span class="p">}</span>
</code></pre></div>
<p>Et voici son implémentation pour Messenger :</p>
<div class="highlight"><pre><span></span><code><span class="kd">class</span><span class="w"> </span><span class="nc">MessengerSearchConnector</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="w"> </span><span class="n">SearchDef</span><span class="p">)</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SearchConnector</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">sendFirstJourney</span><span class="p">(</span><span class="n">sections</span><span class="p">:</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Section</span><span class="o">&gt;</span><span class="p">):</span><span class="w"> </span><span class="n">ConnectorMessage</span><span class="w"> </span><span class="o">=</span>
<span class="w">          </span><span class="n">flexibleListTemplate</span><span class="p">(</span>
<span class="w">                </span><span class="n">sections</span><span class="p">.</span><span class="na">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">section</span><span class="w"> </span><span class="o">-&gt;</span>
<span class="w">                      </span><span class="n">with</span><span class="p">(</span><span class="n">section</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                          </span><span class="n">listElement</span><span class="p">(</span>
<span class="w">                                </span><span class="n">title</span><span class="p">(),</span>
<span class="w">                                </span><span class="n">content</span><span class="p">(),</span>
<span class="w">                                </span><span class="n">trainImage</span>
<span class="w">                          </span><span class="p">)</span>
<span class="w">                      </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="n">compact</span>
<span class="w">          </span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Le code spécifique à chaque connecteur est ainsi correctement découplé. Le code commun à chaque connecteur est présent dans <code>SearchConnector</code> et le comportement spécifique à
chaque connecteur se trouve dans les classes dédiées.</p>
<h3 id="utiliser-storystep">Utiliser <code>StoryStep</code></h3>
<p>Parfois il est nécessaire de se souvenir de l'étape à laquelle l'utilisateur se trouve
dans la story courante. Pour cela Tock met à disposition la notion de <code>StoryStep</code>.</p>
<p>Il existe deux types de <code>StoryStep</code> :</p>
<h4 id="simplestorystep"><code>SimpleStoryStep</code></h4>
<p>A utiliser dans les cas simples, pour lequels on va gérer le comportement induit directement :</p>
<div class="highlight"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MyStep</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SimpleStoryStep</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">}</span>

<span class="kd">val</span><span class="w"> </span><span class="nv">story</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storyWithSteps</span><span class="o">&lt;</span><span class="n">MyStep</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;intent&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">step</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="p">(</span><span class="n">step</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//default case</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Pour modifier l'étape courante, deux méthodes sont disponibles :</p>
<ul>
<li>Modifier manuellement l'étape</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">val</span><span class="w"> </span><span class="nv">story</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">storyWithSteps</span><span class="o">&lt;</span><span class="n">MyStep</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;intent&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">//(...)</span>
<span class="w">    </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyStep</span><span class="p">.</span><span class="na">a</span>
<span class="w">    </span><span class="c1">// l&#39;étape sera persistée tant que nous resterons dans cette story</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Utiliser les boutons ou autres <em>quick replies</em></li>
</ul>
<p>Plus de détails sur ce sujet <a href="#postback-buttons-quick-replies">plus bas</a>.</p>
<h4 id="les-storystep-avec-comportement">Les <code>StoryStep</code> avec comportement</h4>
<p>Dans des cas plus complexes, on souhaite pouvoir définir un comportement pour chaque étape. 
L'utilisation de <a href="#utiliser-handlerdef"><code>HandlerDef</code></a> est alors un prérequis.</p>
<div class="highlight"><pre><span></span><code><span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">MySteps</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">StoryStep</span><span class="o">&lt;</span><span class="n">MyHandlerDef</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>

<span class="w">    </span><span class="c1">//pas de comportement spécifique</span>
<span class="w">    </span><span class="n">display</span><span class="p">,</span>

<span class="w">    </span><span class="n">select</span><span class="w"> </span><span class="p">{</span>

<span class="w">        </span><span class="c1">// la step &quot;select&quot; sera automatiquement sélectionnée si la sous-intention select est détectée</span>
<span class="w">        </span><span class="kd">override</span><span class="w"> </span><span class="kd">val</span><span class="w"> </span><span class="nv">intent</span><span class="p">:</span><span class="w"> </span><span class="n">IntentAware? </span><span class="o">=</span><span class="w"> </span><span class="n">SecondaryIntent</span><span class="p">.</span><span class="na">select</span>
<span class="w">        </span><span class="c1">//dans ce cas la réponse suivante sera apportée</span>
<span class="w">        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">answer</span><span class="p">():</span><span class="w"> </span><span class="n">MyHandlerDef</span><span class="p">.()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Any?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;I don&#39;t know yet how to select something&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>

<span class="w">    </span><span class="n">disruption</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">//seule la réponse est configurée</span>
<span class="w">        </span><span class="kd">override</span><span class="w"> </span><span class="kd">fun</span><span class="w"> </span><span class="nf">answer</span><span class="p">():</span><span class="w"> </span><span class="n">ScoreboardDef</span><span class="p">.()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">Any?</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">end</span><span class="p">(</span><span class="s">&quot;some perturbation&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<p>Davantage d'options de configuration sont disponibles. Consultez la description de 
<a href="https://doc.tock.ai/tock/dokka/tock/ai.tock.bot.definition/-story-step/index.html"><code>StoryStep</code></a>. </p>
<h3 id="postback-buttons-quick-replies"><em>Postback buttons</em> &amp; <em>quick replies</em></h3>
<p>Messenger met à disposition ce type de bouton, et la plupart des connecteurs avec interface graphique font de même.</p>
<p>Tock permet de définir l'action effectuée suite à un clic sur ces boutons. </p>
<p>Dans l'exemple suivant, le bouton redirigera vers l'intention <code>search</code>. </p>
<div class="highlight"><pre><span></span><code><span class="n">buttonsTemplate</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;The bot is very limited! Only itineraries are supported :)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">postbackButton</span><span class="p">(</span><span class="s">&quot;Itineraries&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">search</span><span class="p">)</span>
</code></pre></div>
<p>Il est possible de définir également une <code>StoryStep</code> et des paramètres dédiés :</p>
<div class="highlight"><pre><span></span><code><span class="c1">//pour définir des paramètres, la pratique recommandée est d&#39;étendre l&#39;interface ParameterKey</span>
<span class="kd">enum</span><span class="w"> </span><span class="kd">class</span><span class="w"> </span><span class="nc">ChoiceParameter</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ParameterKey</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">nextResultDate</span><span class="p">,</span><span class="w"> </span><span class="n">nextResultOrigin</span>
<span class="p">}</span>

<span class="n">buttonsTemplate</span><span class="p">(</span>
<span class="w">            </span><span class="s">&quot;The bot is very limited! Only itineraries are supported :)&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="n">postbackButton</span><span class="p">(</span>
<span class="w">                </span><span class="s">&quot;Itineraries&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">intent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">search</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="c1">//si aucune step n&#39;est indiquée, c&#39;est la step courante qui est utilisée</span>
<span class="w">                </span><span class="n">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MyStep</span><span class="p">.</span><span class="na">a</span><span class="p">,</span><span class="w"> </span>
<span class="w">                </span><span class="n">parameters</span><span class="w"> </span><span class="o">=</span><span class="w">  </span>
<span class="w">                    </span><span class="c1">//ce paramètre est stocké sous forme de chaîne de caractère (les crochets sont utilisés)</span>
<span class="w">                    </span><span class="n">nextResultDate</span><span class="o">[</span><span class="n">nextDate</span><span class="o">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span>
<span class="w">                    </span><span class="c1">//ce paramètre est stocké en json (les parenthèses sont utilisées)</span>
<span class="w">                    </span><span class="n">nextResultOrigin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<span class="w">            </span><span class="p">)</span>
</code></pre></div>
<p>Pour récupérer les paramètres du bouton sur lequel on a cliqué :</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">isClick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">isChoiceAction</span><span class="p">()</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">nextDate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">choice</span><span class="p">(</span><span class="n">nextResultDate</span><span class="p">)</span>
<span class="w">    </span><span class="kd">val</span><span class="w"> </span><span class="nv">nextOrigin</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Locality</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action</span><span class="p">.</span><span class="na">jsonChoice</span><span class="p">(</span><span class="n">nextResultOrigin</span><span class="p">)</span>
</code></pre></div>
<h3 id="tests-unitaires">Tests Unitaires</h3>
<p>La page <a href="tester">Tests Unitaires</a> présente le framework fourni pour réaliser des TUs  avec Tock.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "navigation.expand", "navigation.path"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>