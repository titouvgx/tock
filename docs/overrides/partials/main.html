{% extends "base.html" %}

{% block extrahead %}
  <title>DoC-Tock-Chat-Bot</title>
  <html>
    <head>
      <script src="https://unpkg.com/vue@3.4/dist/vue.global.prod.js"></script>
      <link
        rel="stylesheet"
        href="https://unpkg.com/tock-vue-kit@0.3.6/dist/style.css"
      />
      <script
        crossorigin
        src="https://unpkg.com/tock-vue-kit@0.3.6/dist/tock-vue-kit.iife.js"
      ></script>
      <style>
        body {
          font-family: Arial, sans-serif;
          /* background-color: #f4f4f9; */ 
          color: black;
          margin: 0;
          padding: 0;
        }

        #chat-wrapped {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 600px;
          height: 550px;
          border-radius: 12px;
          background-color: white;
          box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
          display: none;
          flex-direction: column;
          transition: all 0.3s ease;
        }

        .chat-header {
          background-color: rgba(0, 120, 215, 0.9);
          color: white;
          padding: 0.5rem 1rem;
          text-align: center;
          font-weight: 600;
          border-top-left-radius: 12px;
          border-top-right-radius: 12px;
          font-size: 1rem;
          display: flex;
          justify-content: space-between;
          align-items: center;
        }

        .chat-footer {
          background-color: rgba(0, 120, 215, 0.9);
          padding: 0.5rem 1rem;
          text-align: center;
          font-size: 0.8rem;
          color: #ffffff;
          border-bottom-left-radius: 12px;
          border-bottom-right-radius: 12px;
        }

        #chat-container {
          flex-grow: 1;
          overflow-y: auto;
          padding: 0.8rem;
          background-color: transparent;
          font-size: 16px;
          white-space: pre-line;
        }
        
        .chat-message {
          padding: 0.3rem 1rem;  
          margin: 0.3rem 1rem;  
          border-radius: 10px;
          font-size: 16px;
        }

        .chat-message.bot {
          background-color: #0078d7;
          color: white;
          text-align: left;
        }

        .chat-message.user {
          background-color: #f4f4f9;
          color: black;
          text-align: right;
        }

        #chat-icon {
          position: fixed;
          bottom: 20px;
          right: 20px;
          width: 60px;
          height: 60px;
          background-color: #0078d7;
          border-radius: 50%;
          color: white;
          font-size: 2rem;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        #chat-icon:hover {
          background-color: #005fa3;
          white-space: pre-line;
          animation: fadeIn 0.8s ease-in-out;
}
        /* Animation pour la fenêtre de chat */
        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          
      }
        }
      </style>
    </head>
{% endblock %}

{% block content %}
{{ super() }}
  <!-- Icône de chat flottant -->
  <div id="chat-icon" onclick="toggleChat()">
    <i class="bi bi-chat"></i>
  </div>

  <!-- Fenêtre du chatbot -->
  <div id="chat-wrapped">
    <div class="chat-header">
      Chatbot Tock
      <!-- Bouton de fermeture -->
      <span onclick="closeChat()" style="cursor: pointer; font-size: 1.5rem;">&times;</span>
    </div>
    <div id="chat-container"></div>
    <div class="chat-footer">Propulsé par Tock</div>
  </div>

  <script>
    console.log("Loading Chatbot...");

    function toggleChat() {
      const chatWindow = document.getElementById("chat-wrapped");
      if (chatWindow.style.display === "none") {
        chatWindow.style.display = "flex"; // Afficher chat
      } else {
        chatWindow.style.display = "none"; // Cacher chat
      }
    }

    function closeChat() {
      const chatWindow = document.getElementById("chat-wrapped");
      chatWindow.style.display = "none"; // Masquer chatbot
    }

    TockVueKit.renderChat(
      document.getElementById("chat-container"),
      "https://demo-bot.tock.ai/io/tock/tockbot/web",
      {
        localStorage: {
          enabled: true,
        },
        initialization: {
          welcomeMessage: "Welcome. How can I help you?",
        },
        preferences: {
          messages: {
            message: {
              header: {
                avatar: {
                  userIcon: "bi bi-incognito",
                  botIcon: "bi bi-sign-dead-end",
                },
                label: {
                  display: false,
                },
              },
            },
            questionBar: {
              clearHistory: {
                icon: "bi bi-heartbreak",
              },
              submit: {
                icon: "bi bi-hammer",
              },
            },
          },
          wording: {
            questionBar: {
              input: {
                placeholder: "Ask me anything...",
              },
            },
          },
        }
      });
  </script>
{% endblock %}

{% block scripts %}
  {{ super() }}
{% endblock %}
